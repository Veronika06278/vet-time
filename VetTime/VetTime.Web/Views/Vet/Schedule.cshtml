@model VetTime.Web.ViewModels.Vet.VetScheduleViewModel

@{
    ViewData["Title"] = "Schedule for " + Model.VetId;
}

<link href="~/css/schedule.css" rel="stylesheet" />

<h2>Book a slot</h2>

<form asp-action="Schedule" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="VetId" />
    <input type="hidden" asp-for="SelectedSlotTime" id="SelectedSlotTime" />

    <div class="d-flex border-bottom pb-2 mb-3">
        @for (int i = 0; i < Model.Days.Count; i++)
        {
            var day = Model.Days[i];
            <div class="me-4 text-center day-header" data-day-index="@i">
                <div>@day.ShortName</div>
                <div class="text-muted">@day.Weekday</div>
            </div>
        }
    </div>

    @for (int i = 0; i < Model.Days.Count; i++)
    {
        var day = Model.Days[i];
        <div class="slot-day mb-4" data-day-index="@i"
             style="display:@(i==0?"block":"none")">
            <div class="d-flex flex-wrap">
                @foreach (var slot in day.Slots)
                {
                    var css = slot.IsBooked ? "slot booked"
                    : slot.IsSelected ? "slot selected"
                    : "slot free";
                    <div class="@css" data-time="@slot.Time.ToString("o")">
                        @slot.Time.ToString("HH:mm")
                    </div>
                }
            </div>
        </div>
    }

    <button type="submit" class="btn btn-success" id="saveButton" disabled>
        Save appointment
    </button>
</form>

@section Scripts {
    <script>
        // Превключване дни
        document.querySelectorAll('.day-header').forEach(h => {
          h.addEventListener('click', () => {
            var idx = h.getAttribute('data-day-index');
            document.querySelectorAll('.slot-day')
              .forEach(c => c.style.display = 'none');
            document.querySelector(`.slot-day[data-day-index="${idx}"]`)
              .style.display = 'block';
          });
        });

        // Избор на слот
        document.querySelectorAll('.slot.free').forEach(el => {
          el.addEventListener('click', () => {
            // премахваме селектирането навсякъде
            document.querySelectorAll('.slot').forEach(s =>
              s.classList.remove('selected'));
            // маркираме този
            el.classList.add('selected');

            // задаваме скритото поле
            var t = el.getAttribute('data-time');
            document.getElementById('SelectedSlotTime').value = t;
            // активираме бутона
            document.getElementById('saveButton').disabled = false;
          });
        });
    </script>
}
